{"version":3,"file":"handle-control-key-down.js","sources":["../../src/utils/handle-control-key-down.ts"],"sourcesContent":["import { RefObject } from 'react';\nimport type { ControlKeydownPayload } from '../types';\n\ntype ControlsRef = RefObject<HTMLButtonElement[][][]>;\n\ninterface ShiftFocusInput {\n  controlsRef: ControlsRef;\n  direction: 'down' | 'up' | 'left' | 'right';\n  index: number;\n  payload: ControlKeydownPayload;\n  count?: number;\n}\n\nfunction focusOnNextFocusableControl({\n  direction,\n  index,\n  payload,\n  count = 1,\n  controlsRef,\n}: ShiftFocusInput) {\n  const changeRow = ['down', 'up'].includes(direction);\n\n  const rowIndex = changeRow\n    ? payload.rowIndex + (direction === 'down' ? count : -count)\n    : payload.rowIndex;\n\n  const cellIndex = changeRow\n    ? payload.cellIndex\n    : payload.cellIndex + (direction === 'right' ? count : -count);\n\n  const controlToFocus = controlsRef.current[index][rowIndex]?.[cellIndex];\n\n  if (!controlToFocus) {\n    return;\n  }\n\n  if (controlToFocus.disabled) {\n    focusOnNextFocusableControl({ direction, index, payload, controlsRef, count: count + 1 });\n  } else {\n    controlToFocus.focus();\n  }\n}\n\ninterface HandleControlKeydownInput {\n  controlsRef: ControlsRef;\n  numberOfColumns: number;\n  index: number;\n  payload: ControlKeydownPayload;\n  event: React.KeyboardEvent<HTMLButtonElement>;\n  controlsPerRow: number | number[];\n}\n\nexport function handleControlKeyDown({\n  controlsRef,\n  index,\n  payload,\n  event,\n  numberOfColumns,\n  controlsPerRow,\n}: HandleControlKeydownInput) {\n  const _controlsPerRow = Array.isArray(controlsPerRow)\n    ? controlsPerRow[payload.rowIndex]\n    : controlsPerRow;\n\n  switch (event.key) {\n    case 'ArrowDown': {\n      event.preventDefault();\n\n      const hasRowBelow = payload.rowIndex + 1 < controlsRef.current[index].length;\n      if (hasRowBelow) {\n        focusOnNextFocusableControl({ direction: 'down', index, payload, controlsRef });\n      }\n      break;\n    }\n\n    case 'ArrowUp': {\n      event.preventDefault();\n\n      const hasRowAbove = payload.rowIndex > 0;\n      if (hasRowAbove) {\n        focusOnNextFocusableControl({ direction: 'up', index, payload, controlsRef });\n      }\n      break;\n    }\n\n    case 'ArrowRight': {\n      event.preventDefault();\n\n      if (payload.cellIndex !== _controlsPerRow - 1) {\n        focusOnNextFocusableControl({ direction: 'right', index, payload, controlsRef });\n      } else if (index + 1 < numberOfColumns) {\n        if (controlsRef.current[index + 1][payload.rowIndex]) {\n          controlsRef.current[index + 1][payload.rowIndex][0]?.focus();\n        }\n      }\n\n      break;\n    }\n\n    case 'ArrowLeft': {\n      event.preventDefault();\n\n      if (payload.cellIndex !== 0) {\n        focusOnNextFocusableControl({ direction: 'left', index, payload, controlsRef });\n      } else if (index > 0) {\n        if (controlsRef.current[index - 1][payload.rowIndex]) {\n          controlsRef.current[index - 1][payload.rowIndex][_controlsPerRow - 1].focus();\n        }\n      }\n    }\n  }\n}\n"],"names":[],"mappings":"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"}